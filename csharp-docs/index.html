<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StyledLines from testedlines.com: C# docs: StyledLines</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="128x128.png"/></td>
  <td id="projectalign">
   <div id="projectname">StyledLines from testedlines.com: C# docs<span id="projectnumber">&#160;1.0.1</span>
   </div>
   <div id="projectbrief">GPT2-based text stylization LLM model, wrapped with Llama.cpp in Csharp to ensure compatibility across various platforms, including iOS and WebGL. The model is designed to transform generic texts into stylized, game or user-tailored dialogue.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">StyledLines </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__styled_lines_2_documentation_2_readme"></a>GPT2-Based Text Stylization Model with Llama.cpp Wrapper</p>
<p>This repository provides a GPT2-based text stylization LLM model, wrapped with Llama.cpp to ensure compatibility across various platforms, including iOS and WebGL. The model is designed to transform generic texts into stylized, game or user-tailored dialogue.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<ul>
<li><b>Text Rewriting</b>: A GPT2-based line rewriter for stylizing texts.</li>
<li><b>Cross-Platform</b>: Compatible with WebGL, iOS, Android, Windows x64, and MacOS (ARM).</li>
<li><b>Async and Sync Execution</b>: Supports asynchronous execution using C++20 threads and synchronous execution as well.</li>
<li><b>Customizable</b>: Allows configuration of Llama.cpp parameters directly within the UnityEditor UI, with setup and execution callbacks.</li>
<li><b>Quantised models on-board</b>: We this package with three model quantised resolutions<ul>
<li>**_Q4_K_M_** most heavily quantised (simplified) one, 110mb</li>
<li>**_Q8_0_** 175mb</li>
<li>**_bf16_** original resolution model, 321mb</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Try It Online</h1>
<p>Experience the model directly in your browser (with the **_Q4_K_M_** model):</p>
<ul>
<li><a href="https://d23myu0xfn2ttc.cloudfront.net/rich/index.html">Automated NPC Dialogue Stylization Demo</a></li>
<li><a href="https://d23myu0xfn2ttc.cloudfront.net/">Single Prompt Debug Demo</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Model Usage Example</h1>
<p>Provide the following input: </p><div class="fragment"><div class="line">&lt;input&gt; How are you today? &lt;inputEnds&gt;</div>
<div class="line">&lt;style&gt; Pirate&#39;s Orwellian and Poetic Question &lt;styleEnds&gt;</div>
<div class="line">&lt;output&gt;</div>
</div><!-- fragment --><p> And it will generate: </p><div class="fragment"><div class="line">Hey there, how fares ye today?</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Model Information</h1>
<ul>
<li><b>Training Data</b>: Finetuned on a corpus of over 0.5 million dialogue lines (64,343,812 tokens) synthetically generated using GPT-4.</li>
<li><b>Tools</b>: Output filtering tools provided in C# for easy editing.</li>
<li><b>Wrapper</b>: Built on Llama.cpp release tag b3490, supporting the latest Llama 3.1 405b model.</li>
<li><b>Model Formats</b>: Weights are available in bf16, int8, q4_k_m resolutions in .gguf format.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Recommendations</h1>
<p>To get the best results, consider using the following styles:</p><ul>
<li><b>Mood Styles</b>: Inquisitive, Emotional, Intellectual, Dynamic, Noble, Light, Foreboding.</li>
<li><b>Writing Styles</b>: Historical, Modern and Contemporary, Genre-Specific, Expressive and Creative.</li>
</ul>
<p><b>Tip</b>: Keep your style descriptions short and concise. Combining mood and writing styles often yields the best results.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Integration Notes</h1>
<ul>
<li><b>WebGL</b>: Limited to 4GB of RAM (x86), and published pages may not work on mobile devices with less RAM (e.g., iOS 17).</li>
<li><b>MacOS/iOS Builds</b>: Requires Mac OS-based computers with CMake and Xcode installed.</li>
<li><b>AI Output</b>: The LLM model may generate tokens that are not parsable by certain fonts.</li>
<li><b>Model Performance</b>: Optimized for one-liners and single sentences.</li>
<li><b>CPP-docs</b>: <a href="https://testedlines.github.io/StyledLines/cpp-docs/index.html">avaliable here</a>, helpfull for rebuilding wrappers</li>
<li><b>CSharp (this docs)</b>: <a href="https://testedlines.github.io/StyledLines/csharp-docs/index.html">avaliable here</a> </li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
License</h1>
<p>The model and code are released under Unity3D Asset Storeâ€™s standard End User License Agreement. See the full EULA <a href="https://assetstore.unity.com/browse/eula-faq">here</a>.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Coding</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Motivating usage example:</h2>
<div class="fragment"><div class="line"><span class="keyword">using </span>System.Collections;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_assets_1_1_styled_lines_1_1_runtime_1_1_model_files_u_i.html">Assets.StyledLines.Runtime.ModelFilesUI</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>MinimalExample : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <a class="code hl_class" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_model_files_u_i_1_1_binary_asset.html">BinaryAsset</a> binaryFileAsset;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> ModelController _llmController = <span class="keyword">null</span>;</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> Start()</div>
<div class="line">    {</div>
<div class="line">        _llmController = <span class="keyword">new</span> ModelController(binaryFileAsset);</div>
<div class="line">        StartCoroutine(GenerateLine());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> IEnumerator GenerateLine()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">string</span> line = <span class="stringliteral">&quot;I love you!&quot;</span>;</div>
<div class="line">        <span class="keywordtype">string</span> style = <span class="stringliteral">&quot;Simple, Confident, Shakespearean&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        var prompt = $<span class="stringliteral">&quot;&lt;input&gt; {line} &lt;inputEnds&gt;\\n&lt;style&gt; {style} &lt;styleEnds&gt;\\n&lt;output&gt;&quot;</span>;</div>
<div class="line">        var <span class="keywordtype">id</span> = _llmController.model.GenerateAsync(prompt);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (!_llmController.model.IsGenerationReady(<span class="keywordtype">id</span>))</div>
<div class="line">        {</div>
<div class="line">            yield <span class="keywordflow">return</span> <span class="keyword">new</span> WaitForSeconds(0.3f);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">string</span> result = _llmController.model.GetGenerationResults(<span class="keywordtype">id</span>);</div>
<div class="line">        result = ModelController.ExtractFirstPart(result, <span class="stringliteral">&quot;&lt;out&quot;</span>);</div>
<div class="line">        <a class="code hl_typedef" href="_run_model_async_8cs.html#a0100be52d45f14348918ea69ec09f959">Debug</a>.Log(result); <span class="comment">// prints out something like &quot;My heart is boundless with affection!&quot;</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="a_run_model_async_8cs_html_a0100be52d45f14348918ea69ec09f959"><div class="ttname"><a href="_run_model_async_8cs.html#a0100be52d45f14348918ea69ec09f959">Debug</a></div><div class="ttdeci">UnityEngine.Debug Debug</div><div class="ttdef"><b>Definition</b> RunModelAsync.cs:8</div></div>
<div class="ttc" id="aclass_assets_1_1_styled_lines_1_1_runtime_1_1_model_files_u_i_1_1_binary_asset_html"><div class="ttname"><a href="class_assets_1_1_styled_lines_1_1_runtime_1_1_model_files_u_i_1_1_binary_asset.html">Assets.StyledLines.Runtime.ModelFilesUI.BinaryAsset</a></div><div class="ttdef"><b>Definition</b> BinaryAsset.cs:7</div></div>
<div class="ttc" id="anamespace_assets_1_1_styled_lines_1_1_runtime_1_1_model_files_u_i_html"><div class="ttname"><a href="namespace_assets_1_1_styled_lines_1_1_runtime_1_1_model_files_u_i.html">Assets.StyledLines.Runtime.ModelFilesUI</a></div><div class="ttdef"><b>Definition</b> BasicGptParamsSettings.cs:5</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Types to First Take a Look At</h2>
<ol type="1">
<li><p class="startli"><b><a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_model_controller.html">ModelController</a></b> <br  />
 <b>Description:</b> <br  />
 The <code>ModelController</code> class is responsible for setting up and configuring the Llama model for inference. It handles loading model parameters, registering necessary callbacks, and managing the context for the inference operations. This class is foundational for configuring the model and ensuring it is ready for use in various tasks.</p>
<p class="startli"><b>Why it's Important:</b> <br  />
 Understanding how to configure and control the Llama model is critical, and <code>ModelController</code> provides the tools to do just that. It's the backbone of the model configuration process, enabling the proper setup of inference parameters and ensuring the model operates as expected.</p>
<p class="startli"><b>References:</b> <br  />
</p><ul>
<li>Class: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_model_controller.html">ModelController</a> <br  />
</li>
<li>Methods: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_model_controller.html#af61c777c48182d3bec3f6c1dd3d36e8c">ExtractFirstPart</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_model_controller.html#a46681d90514c97a90a91a9d0777e4fe4">GetTempPath</a></li>
</ul>
</li>
<li><p class="startli"><b><a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_1_1_callback_wrapper.html">CallbackWrapper</a></b> <br  />
 <b>Description:</b> <br  />
 This static class serves as a bridge between the native library and the managed code, allowing you to register and handle callbacks for logging, token generation, and completion events. It is essential for capturing and responding to various model events during inference operations.</p>
<p class="startli"><b>Why it's Important:</b> <br  />
 Callbacks are critical in asynchronous programming, especially when dealing with model inference. <code>CallbackWrapper</code> allows you to handle these callbacks effectively, enabling responsive and interactive model operations. Without this class, integrating with native library callbacks would be cumbersome and error-prone.</p>
<p class="startli"><b>References:</b> <br  />
</p><ul>
<li>Class: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_1_1_callback_wrapper.html">CallbackWrapper</a> <br  />
</li>
<li>Methods: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_1_1_callback_wrapper.html#abd96cb93684352bd76e733d4907a19f9">RegisterLogCallback</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_1_1_callback_wrapper.html#ac94cfbc5b52ab58117b391e3ccb69bbe">RegisterTokenCallback</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_1_1_callback_wrapper.html#a179d4d8c24348da755b4caa4ebec3871">RegisterCompletionCallback</a></li>
</ul>
</li>
<li><p class="startli"><b><a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html">RunModelAsync</a></b> <br  />
 <b>Description:</b> <br  />
 This class is detailed example on managing the lifecycle of asynchronous model generation tasks. It handles initialization, generation, and the state transitions of the Llama model, showing how to run and control the model. The <code>RunModelAsync</code> class also provides methods to monitor and manage model outputs, log handling, and event dispatching.</p>
<p class="startli"><b>Why it's Important:</b> <br  />
 If you're working with asynchronous operations and need to manage the state and lifecycle of model inference, this class is your go-to. It encapsulates all the necessary functionality to start, monitor, and stop model tasks in an asynchronous environment, making it essential for any non-blocking operations.</p>
<p class="startli"><b>References:</b> <br  />
</p><ul>
<li>Class: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html">RunModelAsync</a> <br  />
</li>
<li>State Enumeration: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html#a48eb3d2d8aee640cc472403bab2a6b4b">RunModelAsync.State</a> <br  />
</li>
<li>Methods: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html#a788947d76476ab17b741e3df3d13de95">Generate</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html#af757f7efeb4be3710ca96fadcec9408c">DoSetup</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html#a93352c3bc627fe14cf66719b7de80e87">Start</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_run_model_async.html#aabe6cc4182e4b6029714bff7b9076a34">Update</a></li>
</ul>
</li>
<li><p class="startli"><b><a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_dialog_utils_1_1_dialog_manager.html">DialogManager</a></b> <br  />
 <b>Description:</b> <br  />
 The <code>DialogManager</code> class is an example designed to manage dialog interactions between characters in a scene. It processes dialog scripts, assigns styles to character speech, and handles the display of text above characters using Unity's TextMeshPro. This class integrates with the Llama model to dynamically generate character speech based on predefined styles and input text.</p>
<p class="startli"><b>Why it's Important:</b> <br  />
 <code>DialogManager</code> is essential if you're creating interactive scenes or narrative-driven content where characters engage in dialog. It automates the process of managing dialog sequences, ensuring smooth transitions and dynamic content generation.</p>
<p class="startli"><b>References:</b> <br  />
</p><ul>
<li>Class: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_dialog_utils_1_1_dialog_manager.html">DialogManager</a> <br  />
</li>
<li>Methods: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_dialog_utils_1_1_dialog_manager.html#a38b321d8b3be72540eab19e2617352b5">StartDialog</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_dialog_utils_1_1_dialog_manager.html#a5f8f765bf2bba39f00acbfe9d5adab95">ShowNextLine</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_dialog_utils_1_1_dialog_manager.html#aace0d2b97d89e6892a4738f1e8c8412f">ReparseDialogAndStyles</a></li>
</ul>
</li>
<li><p class="startli"><b><a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_minimal_example.html">MinimalExample</a></b> <br  />
 <b>Description:</b> <br  />
 The <code>MinimalExample</code> class is a simple demonstration of how to set up and use the <code>ModelController</code> to generate text asynchronously. It initializes the model with a binary asset, sends a prompt for text generation, and outputs the generated text to the Unity console.</p>
<p class="startli"><b>Why it's Important:</b> <br  />
 This class provides a basic, hands-on example of how to get started with the <a class="el" href="namespace_llama_library.html">LlamaLibrary</a>. It's perfect for beginners who want to see the basics of model interaction in action without diving into more complex systems.</p>
<p class="startli"><b>References:</b> <br  />
</p><ul>
<li>Class: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_minimal_example.html">MinimalExample</a> <br  />
</li>
<li>Methods: <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_minimal_example.html#aaed938d97be4e225c763c1eaf666bf26">Start</a>, <a class="el" href="class_assets_1_1_styled_lines_1_1_runtime_1_1_llama_infrence_unity_1_1_minimal_example.html#aa2c607981a96d13a2edbc95d47a87282">GenerateLine</a> </li>
</ul>
</li>
</ol>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FVWLBH4VQZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FVWLBH4VQZ');
</script>
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer"> <a href="https://testedlines.com/">Visit Tested Lines website!</a> </li>
    <li class="footer">Generated by Tested Lines using <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
