<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Llama.cpp C++-to-Csharp wrapper from testedlines.com: C++ docs: About</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="128x128.png"/></td>
  <td id="projectalign">
   <div id="projectname">Llama.cpp C++-to-Csharp wrapper from testedlines.com: C++ docs<span id="projectnumber">&#160;1.0.1</span>
   </div>
   <div id="projectbrief">Llama.cpp C++-to-Csharp wrapper is a minor extension to Llama.cpp tag b3490 codebase modified a bit by testedlines allowing it to be compiled for and called from Styled Lines Csharp unity asset store package.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">About </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_wrapper_2_readme"></a>Llama.cpp C++-to-Csharp wrapper is a minor extension to Llama.cpp tag b3490 codebase modified a bit by testedlines allowing it to be compiled for and called from Styled Lines Csharp unity asset store package.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
License</h1>
<p>Llama.cpp C++-to-Csharp wrapper from testedlines.com distributed under Standard Unity Asset Store EULA (see: <a href="https://unity.com/legal/as-terms">https://unity.com/legal/as-terms</a>)</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Building</h1>
<p>This document provides step-by-step instructions to build and deploy the "Llama.cpp C++-to-Csharp wrapper from testedlines.com" across various platforms, including Windows, Android, MacOS, iOS, and WebGL. Each section details the necessary build commands and subsequent actions required to properly configure and deploy the build artifacts.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Pre-build Steps</h2>
<h3><a class="anchor" id="autotoc_md4"></a>
1. Generate C++ Interface Wrapper for CSharp</h3>
<p>Before proceeding with platform-specific builds, we need to generate a C++ interface wrapper that will allow C# integration. To do this, navigate to the <code>cpp-sources/wrapper/infrence-lib</code> directory and execute the following Docker command:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; --entrypoint /bin/bash olejak/swig-monoaot -c &#39;cd /llama/wrapper/infrence-lib &amp;&amp; /usr/local/bin/swig -c++ -csharp -monoaotcompat -namespace LlamaLibrary -outdir ../dotnet/LlamaCppInfrence -o LlamaWrapper.cxx -I&quot;../../&quot; -I&quot;../../common/&quot; -I&quot;./&quot; lib.i&#39;</div>
</div><!-- fragment --><p>This command generates the necessary C++ wrapper and outputs the files to the <code>dotnet/LlamaCppInfrence</code> directory. These files will be used later in the Unity3D C# wrapper build process. You can build that docker image using Docker file avaliable in <code>Docker-swig</code> folder.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md6"></a>
Windows-x64 Build</h2>
<p>Please use PoweShell for calling docker commands on Windows platforms as they allow use of getting current directory "$(pwd)" in the manner compatible with MacOS.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
1. Building for Windows-x64</h3>
<p>To build the project for Windows-x64, use the following Docker command from PoweShell:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; dockcross/windows-static-x64 /bin/bash -c &quot;cd /llama &amp;&amp; rm -rf ./build-win ; mkdir build-win &amp;&amp; cd build-win &amp;&amp; cmake -DBUILD_SHARED_LIBS=OFF .. &amp;&amp; make -j llama_lib&quot;</div>
</div><!-- fragment --><p><b>Expected Artifacts:</b></p>
<ul>
<li><code>libllama_lib.dll</code>: This file will be generated in the <code>build-win/bin</code> directory.</li>
<li><b>Action</b>: Copy <code>libllama_lib.dll</code> into the following locations:<ul>
<li><code>wrapper/dotnet/LlamaCppDemo</code></li>
<li><code>Assets/StyledLines/Plugins/Windows</code> or</li>
</ul>
</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md9"></a>
Android Build</h2>
<h3><a class="anchor" id="autotoc_md10"></a>
1. ARM64 (arm64-v8a)</h3>
<p>To build for ARM64 (arm64-v8a), execute:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; dockcross/android-arm64 /bin/bash -c &quot;cd /llama &amp;&amp; rm -rf ./build-arm64-v8a ; mkdir build-arm64-v8a &amp;&amp; cd build-arm64-v8a &amp;&amp; cmake -DBUILD_SHARED_LIBS=OFF -DANDROID_PLATFORM=android-22 -DCMAKE_C_FLAGS=&#39;-march=armv8.4a+dotprod -fPIC -flto -fopenmp -static-openmp -static-libgcc&#39; -DCMAKE_CXX_FLAGS=&#39;-fPIC -flto -fopenmp -static-openmp -static-libstdc++ -static-libgcc&#39; -DANDROID_ABI=arm64-v8a -DCMAKE_BUILD_TYPE=Release .. &amp;&amp; make -j llama_lib&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
2. ARMv7 (armeabi-v7a)</h3>
<p>For ARMv7 (armeabi-v7a) builds, use:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; dockcross/android-arm /bin/bash -c &quot;cd /llama &amp;&amp; rm -rf ./build-armeabi-v7a ; mkdir build-armeabi-v7a &amp;&amp; cd build-armeabi-v7a &amp;&amp; cmake -DBUILD_SHARED_LIBS=OFF -DANDROID_PLATFORM=android-22 -DCMAKE_C_FLAGS=&#39;-march=armv7-a -m32 -fPIC -flto -fopenmp -static-openmp -static-libgcc&#39; -DCMAKE_CXX_FLAGS=&#39;-m32 -fPIC -flto -fopenmp -static-openmp -static-libstdc++ -static-libgcc&#39; -DANDROID_ABI=armeabi-v7a -DCMAKE_BUILD_TYPE=Release .. &amp;&amp; make -j llama_lib&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
3. x86</h3>
<p>To build for Android x86:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; dockcross/android-x86 /bin/bash -c &quot;cd /llama &amp;&amp; rm -rf ./build-x86 ; mkdir build-x86 &amp;&amp; cd build-x86 &amp;&amp; cmake -DBUILD_SHARED_LIBS=OFF -DANDROID_PLATFORM=android-22 -DCMAKE_C_FLAGS=&#39;-march=i686 -m32 -fPIC -flto -fopenmp -static-openmp -static-libgcc&#39; -DCMAKE_CXX_FLAGS=&#39;-m32 -fPIC -flto -fopenmp -static-openmp -static-libstdc++ -static-libgcc&#39; -DANDROID_ABI=x86 -DCMAKE_BUILD_TYPE=Release .. &amp;&amp; make -j llama_lib&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md13"></a>
4. x86_64</h3>
<p>For x86_64 builds:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; dockcross/android-x86_64 /bin/bash -c &quot;cd /llama &amp;&amp; rm -rf ./build-x86_64 ; mkdir build-x86_64 &amp;&amp; cd build-x86_64 &amp;&amp; cmake -DBUILD_SHARED_LIBS=OFF -DANDROID_PLATFORM=android-22 -DCMAKE_C_FLAGS=&#39;-march=x86-64 -fPIC -flto -fopenmp -static-openmp -static-libgcc&#39; -DCMAKE_CXX_FLAGS=&#39;-fPIC -flto -fopenmp -static-openmp -static-libstdc++ -static-libgcc&#39; -DANDROID_ABI=x86_64 -DCMAKE_BUILD_TYPE=Release .. &amp;&amp; make -j llama_lib&quot;</div>
</div><!-- fragment --><p><b>Expected Artifacts for Android Builds:</b></p>
<p>For each build configuration, the <code>libllama_lib.a</code> will be generated in the corresponding <code>build-&lt;ABI&gt;</code> directory.</p>
<p><b>Action</b>: Copy the artifacts from the <code>wrapper/infrence-lib</code> build directories of each build into your Unity project for the respective Android platform like <code>Assets/StyledLines/Plugins/Android/libs</code>.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md15"></a>
MacOS and iOS Build</h2>
<h3><a class="anchor" id="autotoc_md16"></a>
Prerequisites</h3>
<p>Before building for iOS or MacOS, ensure you have Xcode and CMake installed:</p>
<div class="fragment"><div class="line">brew install cmake</div>
<div class="line">xcode-select --install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md17"></a>
1. Building for iOS</h3>
<p>To build for iOS, follow these steps:</p>
<div class="fragment"><div class="line">mkdir build-ios</div>
<div class="line">git clone --recursive https://github.com/leetal/ios-cmake</div>
<div class="line">cmake -G Xcode -DCMAKE_TOOLCHAIN_FILE=$(pwd)/ios-cmake/ios.toolchain.cmake -DGGML_METAL=OFF -DPLATFORM=OS64COMBINED -DLLAMA_BUILD_EXAMPLES=OFF -DLLAMA_BUILD_TESTS=OFF -DLLAMA_BUILD_SERVER=OFF -DBUILD_LLAMA_WRAPPER_DEMO=OFF -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF ..</div>
<div class="line">xcodebuild -target llama_lib -configuration Release</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
2. Building for MacOS</h3>
<p>For MacOS, execute:</p>
<div class="fragment"><div class="line">mkdir build-mac</div>
<div class="line">git clone --recursive https://github.com/leetal/ios-cmake</div>
<div class="line">cmake -G Xcode -DCMAKE_TOOLCHAIN_FILE=$(pwd)/ios-cmake/ios.toolchain.cmake -DGGML_METAL=OFF -DPLATFORM=MAC_UNIVERSAL -DLLAMA_BUILD_EXAMPLES=OFF -DLLAMA_BUILD_TESTS=OFF -DLLAMA_BUILD_SERVER=OFF -DBUILD_LLAMA_WRAPPER_DEMO=OFF -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">xcodebuild -target llama_lib -configuration Release</div>
</div><!-- fragment --><p><b>Expected Artifacts:</b></p>
<ul>
<li><code>llama_lib.bundle</code>: After building, you should have the bundle library file (that may show up as a directory on windows) <code>llama_lib.bundle</code> in the build directory, which can be integrated into iOS or MacOS applications by copiing it into <code>Assets/StyledLines/Plugins/Mac</code>.</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md20"></a>
WebGL Build</h2>
<p>To build for WebGL, execute the following Docker command:</p>
<div class="fragment"><div class="line">docker run -it -v &quot;$(pwd)/../../:/llama&quot; emscripten/emsdk:3.1.8 /bin/bash -c &quot;cd /llama &amp;&amp; rm -rf ./build-web ; mkdir build-web &amp;&amp; cd build-web &amp;&amp; emcmake cmake -DBUILD_SHARED_LIBS=OFF -DEMSCRIPTEN=ON .. &amp;&amp; export EMCC_CFLAGS=&#39;-pthread -O3 -msimd128 -fno-rtti -DNDEBUG -flto=full -fpic -s BUILD_AS_WORKER=0 -s EXPORT_ALL=1 -s EXPORT_ES6=1 -s MODULARIZE=1 -s INITIAL_MEMORY=128MB -s MAXIMUM_MEMORY=2GB -s ALLOW_MEMORY_GROWTH=1 -s FORCE_FILESYSTEM=1 -s NO_EXIT_RUNTIME=1&#39; &amp;&amp; emmake make -j llama_lib&quot;</div>
</div><!-- fragment --><p><b>Expected Artifacts:</b></p>
<ul>
<li><p class="startli">From the <code>build-web</code> folder, copy the following files:</p><ul>
<li><code>common/libcommon.a</code></li>
<li><code>ggml/src/libggml.a</code></li>
<li><code>src/libllama.a</code></li>
<li><code>wrapper/infrence-lib/libllama_lib.a</code></li>
</ul>
<p class="startli"><b>Action</b>: Place these files into the <code>Assets/StyledLines/Plugins/WebGL/</code> directory in your Unity project.</p>
</li>
</ul>
<p><b>Note</b>: The WebGL build process may take approximately 25 minutes in optimized mode, Code optimisation with Runtime Speed with LTO on project build is recommended.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md22"></a>
Building Llama.cpp C++-to-Csharp wrapper for Unity3D</h1>
<p>After the Llama.cpp builds are complete, we proceed to build the C# wrapper for Unity3D. You have two options:</p>
<h3><a class="anchor" id="autotoc_md23"></a>
Option A: Automated Build</h3>
<p>Run the following Docker command:</p>
<div class="fragment"><div class="line">docker run --rm -v &quot;$(pwd)/../:/wrapper&quot; -v &quot;$(pwd)/../autofix_csharp_on_build.sh:/automate.sh&quot; ubuntu:20.04 /bin/bash /automate.sh</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md24"></a>
Option B: Manual Modifications</h3>
<ol type="1">
<li>In the file containing the class <code>libllama_libPINVOKE</code>, replace <code>"libllama_lib"</code> with <code>LIBRARY_NAME</code>.</li>
<li>Add the following code after the line <code>class libllama_libPINVOKE {</code>:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#if UNITY_STANDALONE_OSX || UNITY_EDITOR_OSX</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keywordtype">string</span> LIBRARY_NAME = <span class="stringliteral">&quot;llama_lib.bundle&quot;</span>;</div>
<div class="line"><span class="preprocessor">#elif UNITY_IOS &amp;&amp; !UNITY_EDITOR</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="keywordtype">string</span> LIBRARY_NAME = <span class="stringliteral">&quot;__Internal&quot;</span>;</div>
<div class="line"><span class="preprocessor">#elif UNITY_ANDROID &amp;&amp; !UNITY_EDITOR</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="keywordtype">string</span> LIBRARY_NAME = <span class="stringliteral">&quot;libllama_lib.so&quot;</span>;</div>
<div class="line"><span class="preprocessor">#elif UNITY_WEBGL &amp;&amp; !UNITY_EDITOR</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">string</span> LIBRARY_NAME = <span class="stringliteral">&quot;__Internal&quot;</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keywordtype">string</span> LIBRARY_NAME = <span class="stringliteral">&quot;libllama_lib&quot;</span>; <span class="comment">// Default name for other platforms</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><ol type="1">
<li>In the file containing <code>public class <a class="el" href="struct_llama_infrence.html" title="Provides an interface for inference operations on a model, such as GPT (yet any LLama....">LlamaInfrence</a> : global::System.IDisposable {</code>, set the constructor to <code>public <a class="el" href="struct_llama_infrence.html" title="Provides an interface for inference operations on a model, such as GPT (yet any LLama....">LlamaInfrence</a>(global::System.IntPtr cPtr, bool cMemoryOwn)</code>.</li>
<li>In the file containing <code>public class <a class="el" href="class_logging_context.html" title="Manages callback functions for logging, token processing, and completion events.">LoggingContext</a> : global::System.IDisposable {</code>, set <code>public global::System.Runtime.InteropServices.HandleRef swigCPtr;</code> to public.</li>
</ol>
<h3><a class="anchor" id="autotoc_md25"></a>
Final Steps</h3>
<ul>
<li>Copy the files from <code>wrapper/dotnet/LlamaCppInfrence</code> into <code>Assets/StyledLines/Runtime/LlamaInfrence</code>.</li>
<li>Copy <code>CallbackWrapper.cs</code> from <code>wrapper/dotnet/LlamaCppDemo</code> into <code>Assets/StyledLines/Runtime/LlamaInfrence</code>. </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FVWLBH4VQZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FVWLBH4VQZ');
</script>
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer"> <a href="https://testedlines.com/">Visit Tested Lines website!</a> </li>
    <li class="footer">Generated by Tested Lines using <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
